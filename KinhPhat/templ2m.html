<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <style type="text/css">
        button.miBtn {
            display: table-cell;
            padding: 0;
            margin: 0;
            margin-top: 4px;
            margin-left: 2px;
            margin-right: 2px;
            background-color: transparent;
            border: none;
            /*font-size: small;*/
            font-family: 'MS Gothic';
        }

        span.miLabel:hover {
            color: blue;
            text-decoration: underline;
        }

        span.miLabel {
            padding: 0;
            padding-left: 2px;
            padding-right: 2px;
            margin: 0;
            display: table-cell
        }

        div.menuItem {
            width: auto;
            display: table;
        }

        div.miChilds {
            margin-left: 10px;
        }
    </style>
    <style>
        div.topCtrls {
            position:fixed;
            top:5px;
            padding: 5px;
            background-color: #808080;
            width: 100%;
        }
        div.menu {
            position:fixed;
            top:50px;
            width: 400px;
            height:100%;
            overflow:scroll;
            background-color: rgb(209, 209, 209);
            display: table-cell;
        }

        div.content {
            position:fixed;
            top:50px;
            width: 100%;
            height:100%;
            overflow:scroll;
            display: table-cell;
        }
        table,td {
            vertical-align:top;
            border-width:0px;
            border-collapse: collapse;
        }
        button.fontBtn {
            font-family:'MS Gothic';
        }
    </style>
</head>
<body　id="body" style="font-family:'Times New Roman';margin:5px;">
    <div id="id_content" class="content">
        <p style="text-align: center">sentence</p>
        <p>sentence</p>
        <p>sentence</p>
        <p>sentence</p>
        <p>sentence</p>
        <p>sentence</p>
    </div>
    <button id ="id_gotoTopBtn" onclick="gotoTop()" style ="position:fixed;right:2px;bottom:2px">△</button>
    <div id="id_topCtrls" class="topCtrls" >
        <table style="width:100%;border-width:0px;border-collapse: collapse">
            <tr>
                <td style="width: auto">
                    <button style="width: auto" id="showHideMenuBtn" onclick="menuShowHide()">目</button>
                </td>
                <td>
                    <span id="span1" style="white-space:nowrap">Kinh Tiểu Bộ</span>
                </td>
                <td style="width: 100%"></td>
                <td>
                    <button id="fontInc" class="fontBtn" onclick="incFont()">＋</button>
                </td>
                <td>
                    <button id="fontDec" class="fontBtn" onclick="decFont()">―</button>
                </td>
                <td>
                    <button id="fontAdjBtn" class="fontBtn" onclick="onAdjFont()">〇</button>
                </td>
            </tr>
        </table>
    </div>
    <div id="id_botCtrls" style="position:fixed;bottom:10px;right:10px">
        <table style="width: 100%; border-width: 0px; border-collapse: collapse">
            <tr>
                <td style="width:100%"></td>
                <td>
                    <button id="id_playContent" onclick="onPlayContent()">⏯️</button>
                </td>
                <td>
                    <button id="id_stopSpeek" onclick="onStopSpeek()">⏹️</button>
                </td>
                <td>
                    <span id="id_playContentSts" style="font-family:'MS Gothic'">stoped&nbsp;</span>
                </td>
            </tr>
        </table>
    </div>
    <div id="id_menu" class="menu">
        <div id="root_childs" class="miChilds">
            <div class="menuItem">
                <button id="node1_img" class="miBtn" onclick="onImgClick('node1')">+</button>
                <button id="node1_sts" class="miBtn" onclick="onStsClick('node1')">□</button>
                <span id="node1_span" class="miLabel" onclick="onSpanClick('node1')">node1</span>
            </div>
            <div id="node1_childs" class="miChilds">
                <div class="menuItem">
                    <button id="node1_1_img" class="miBtn" onclick="onImgClick('node1')">+</button>
                    <button id="node1_1_sts" class="miBtn" onclick="onStsClick('node1')">□</button>
                    <span id="node1_1_span" class="miLabel" onclick="onSpanClick('node1')">node1.1</span>
                </div>
                <div id="node1_1_childs" class="miChilds">
                </div>
            </div>
            <div class="menuItem">
                <button id="node2_img" class="miBtn" onclick="onImgClick('node1')">+</button>
                <button id="node2_sts" class="miBtn" onclick="onStsClick('node1')">□</button>
                <span id="node2_span" class="miLabel" onclick="onSpanClick('node1')">node2</span>
            </div>
            <div id="node2_childs" class="miChilds">
            </div>
        </div>
    </div>
    <span id="log" style="color: gray" hidden="hidden">playing:</span>
    <script>
        //chk lnk is mp3, mp4 or youtube
        function getLnkObj(lnk) {
            var lnkType;
            if (lnk.search(/\.mp4$/i) != -1) {
                lnkType = "mp4";
            }
            else if (lnk.search(/\.mp3$/i) != -1) {
                lnkType = "mp3";
            }
            else {
                lnkType = "youtube";
                ytlnk = crtYTEmbed(lnk);
                if (ytlnk != '') {
                    lnk = ytlnk;
                }
            }
            return { "lnk": lnk, "lnkType": lnkType };
        }

        //get browser info
        function who() {
            var ua = navigator.userAgent, tem,
                M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
            if (/trident/i.test(M[1])) {
                tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
                return 'IE ' + (tem[1] || '');
            }
            if (M[1] === 'Chrome') {
                tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
                if (tem != null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
            }
            M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
            if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
            //return M.join(' ');
            return ua;
        }

        function crtYTEmbed(url) {
            var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            var match = url.match(regExp);

            if (match && match[2].length == 11) {
                return 'https://www.youtube.com/embed/' + match[2];
            } else {
                return '';
            }
        }
        function toggle(id) {
            var x = document.getElementById(id);
            if (x.style.display == "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }

        //__in showhide: true-> show
        function show(id, showhide) {
            var x = document.getElementById(id);
            if (showhide) {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }

        //video1 controls
        function playPause(id) {
            ctrl = document.getElementById(id);
            if (ctrl.paused)
                ctrl.play();
            else
                ctrl.pause();
        }

        function makeBig(id) {
            ctrl = document.getElementById(id);
            w = Math.min(ctrl.width * 1.1, 1080);
            resize(id, w);
        }

        function makeSmall(id) {
            ctrl = document.getElementById(id);
            w = Math.max(ctrl.width * 0.9, 360);
            resize(id, w);
        }

        function makeNormal(id) {
            resize(id, 480);
        }
        function resize(id, w) {
            ctrl = document.getElementById(id);
            ctrl.width = w;
            if (id == "frame1") {
                ctrl.height = w * m_scale;
            }
        }
    </script>
    <script>
        //init var part2///////
        //tree
        var g_nodesDict = {};
        var g_titlesDict = {};
        var baseUrl = window.location.href.replace(/\/[^/]*\.html/, "");
        var imgSrc = {
            "expand": "＋",
            "colapse": "―",
            "noop": "　",
            "checked": "■",
            "uncheck": "□",
            "gray": "▲",
        };
    </script>
    <script>
        //tree
        // render item by item
        function render1(lectLst) {
            document.getElementById(rootNode.id + "_childs").innerHTML = "";
            rootNode.visible = true;

            for (var i in lectLst) {
                addLectItem(rootNode, lectLst[i]);
            }
        }

        // render hold tree
        function render2(lectLst) {
            for (var i in lectLst) {
                addNode(rootNode, lectLst[i]);
            }
            treeRender(rootNode);
        }

        // get data from web and render async
        function render3(url) {
            document.getElementById(rootNode.id + "_childs").innerHTML = "";
            rootNode.visible = true;

            //getItems();
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var jsTxt = xhttp.responseText;
                    var items = eval("(" + jsTxt + ")");
                    for (var i in items) {
                        var lectItem = items[i];
                        addLectItem(rootNode, lectItem);
                    }
                }
            };
            xhttp.open('GET', url, true);
            xhttp.send();
        }


        function getLecturesSync(url) {
            var xhttp = new XMLHttpRequest();
            xhttp.open('GET', url, false);
            xhttp.send();
            if (xhttp.status == 200) {
                return eval("(" + xhttp.responseText + ")");
            } else {
                return [];
            }
        }

        ////////////////////////////////////////////
        //function getItems() {
        //  var uri = "https://localhost:44336/api/Lectures";
        //  fetch(uri)
        //    .then(response => response.json())
        //    .then(data => _displayItems(data))
        //    .catch(error => console.error('Unable to get items.', error));
        //}
        //function _displayItems(data) {
        //  data.forEach(item => {
        //    addLectItem(rootNode,item);
        //  });
        //}
        ////////////////////////////////////////////
        //add lecture item to root node
        function addNode(root, lectItem) {
            var path = [lectItem.author, lectItem.target, lectItem.topic];
            var parent = root;
            var child;
            for (var i in path) {
                var name = path[i];
                if (parent.childs[name] != null) {
                    child = parent.childs[name];
                } else {
                    var id = parent.id + '_' + Object.keys(parent.childs).length;
                    child = {
                        "id": id,
                        "name": name,
                        "childs": [],
                    };
                    parent.childs[name] = child;
                }
                parent = child;
            }
            parent.childs[lectItem.title] = {
                "id": parent.id + '_' + lectItem.title,
                "name": lectItem.title,
                "lect": lectItem,
            };
        }

        //add and render lecture item
        function addLectItem(root, lectItem) {
            var path = lectItem.path.split('/');
            var parent = root;
            var child;
            var renderLst = [];
            for (var i in path) {
                var name = path[i];
                if (parent.childs[name] != null) {
                    child = parent.childs[name];
                } else {
                    var id = parent.id + '_' + Object.keys(parent.childs).length;
                    child = {
                        "id": id,
                        "name": name,
                        "childs": [],
                    };
                    parent.childs[name] = child;

                    //add to render lst
                    renderLst.push([parent, child]);
                }
                parent = child;
            }

            child.childs = null;
            child.lect = lectItem;
            g_titlesDict[lectItem.ID] = child;  //for restore sts

            //render nodes
            for (var i in renderLst) {
                parent = renderLst[i][0];
                child = renderLst[i][1];
                treeAdd(parent, child);
                g_nodesDict[child.id] = child;
            }
        }

        function treeRender(rootNode) {
            document.getElementById(rootNode.id + "_childs").innerHTML = "";
            rootNode.visible = true;
            treeAddR(rootNode);
        }
        function treeAddR(parentNode) {
            var i;
            for (i in parentNode.childs) {
                var childNode = parentNode.childs[i];
                treeAdd(parentNode, childNode);
                g_nodesDict[childNode.id] = childNode;
                treeAddR(childNode);
            }
        }
        function treeAdd(parentNode, childNode) {
            //init node
            childNode.parent = parentNode;
            childNode.sts = 0;  //uncheck
            childNode.visible = true;

            //var imgTxt = '<img id="[nodeId]_img" class="toggleImg" src="[imgSrc]" onclick="onImgClick(' + "'[nodeId]'" + ')"></img>';
            //imgTxt = imgTxt.replace(/\[nodeId\]/g, childNode.id);
            //imgTxt = imgTxt.replace(/\[imgSrc\]/g, imgSrc.colapse);
            //if (childNode.childs == null) {
            //    imgTxt = '<img src="' + imgSrc.noop + '" ></img>'
            //}
            var img1 = document.createElement("button");
            img1.id = childNode.id + "_img";
            img1.className = "miBtn";
            img1.textContent = imgSrc.colapse;
            if (childNode.childs == null) { img1.textContent = imgSrc.noop };
            img1.onclick = function () { onImgClick(childNode.id) };

            //var stsTxt = '<img id="[nodeId]_sts" class="stsImg" src="[stsSrc]" onclick="onStsClick(' + "'[nodeId]'" + ')"></img>';
            //stsTxt = stsTxt.replace(/\[nodeId\]/g, childNode.id);
            //stsTxt = stsTxt.replace(/\[stsSrc\]/g, imgSrc.uncheck);
            var sts1 = document.createElement("button");
            sts1.id = childNode.id + "_sts";
            sts1.className = "miBtn";
            sts1.textContent = imgSrc.uncheck;
            sts1.onclick = function () { onStsClick(childNode.id) };

            //var spanTxt = '<span id="[nodeId]_span" class="txtbtn" onclick="onSpanClick(' + "'[nodeId]'" + ')">[nodeName]</span><br>';
            //spanTxt = spanTxt.replace(/\[nodeId\]/g, childNode.id);
            //spanTxt = spanTxt.replace(/\[nodeName\]/g, childNode.name);
            var span1 = document.createElement("span");
            span1.id = childNode.id + "_span";
            span1.className = "miLabel";
            span1.textContent = childNode.name;
            span1.onclick = function () { onSpanClick(childNode.id) };

            var div1 = document.createElement("div");
            div1.className = "menuItem";
            //var span11 = document.createElement("span");
            //span11.appendChild(img1);
            //span11.appendChild(sts1);
            //div1.appendChild(span11);
            //div1.appendChild(img1);
            //div1.appendChild(sts1);
            //div1.appendChild(span1);

            var tbl = document.createElement("table");
            var tr = document.createElement("tr");
            tbl.appendChild(tr);
            var td = document.createElement("td");
            td.appendChild(img1);
            tr.append(td);
            var td = document.createElement("td");
            td.appendChild(sts1);
            tr.append(td);
            var td = document.createElement("td");
            tr.append(td);
            td.appendChild(span1);
            div1.append(tbl);

            //var divTxt = '<div id="[nodeId]_childs" class="childsDiv">';
            //divTxt = divTxt.replace(/\[nodeId\]/g, childNode.id);
            var div2 = document.createElement("div");
            div2.className = "miChilds";
            div2.id = childNode.id + "_childs";

            var tDiv = document.getElementById(parentNode.id + "_childs");
            //tDiv.innerHTML += imgTxt + stsTxt + spanTxt + divTxt;
            tDiv.appendChild(div1);
            tDiv.appendChild(div2);
        }
        function updateChildSts(tNode) {
            var childs = tNode.childs;
            var sts = tNode.sts;
            var i;
            for (i in childs) {
                var childNode = childs[i];
                childNode.sts = sts;
                updateStsImg(childNode);

                updateChildSts(childNode);
            }
        }
        function updateParentSts(tNode, sts) {
            if (tNode.id == "root") return;
            var childs = tNode.childs;
            if (sts != 2) {
                for (var i in childs) {
                    var childNode = childs[i];
                    if (childNode.sts != sts) {
                        sts = 2;
                        break;
                    }
                }
            }
            tNode.sts = sts;
            updateStsImg(tNode);

            //recursive
            updateParentSts(tNode.parent, sts);
        }

        function updateStsImg(tNode) {
            var src;
            switch (tNode.sts) {
                case 0:
                    src = imgSrc.uncheck;
                    //if (tNode.lect != null) {
                    //    alert("ucheck:" + tNode.lect.ID)
                    //}
                    break;
                case 1:
                    src = imgSrc.checked;
                    //if (tNode.lect != null) {
                    //    alert("check:" + tNode.lect.ID)
                    //}
                    break;
                default:
                    src = imgSrc.gray;
            }
            var tImg = document.getElementById(tNode.id + "_sts");
            //tImg.src = src;
            tImg.textContent = src;
        }

        //"2018-04-10T04:00:00.000Z"
        function getDate(zTxt) {
            return zTxt.match(/.*(?=T)/);
        }
    </script>
    <script>
        //var init///////////////////////
        var nodeLst = {
            "id": "root",
            "name": "root node",
            "childs": [
                {
                    "id": "id_1",
                    "name": "name 1",
                    "childs": [
                        {
                            "id": "id_1_1",
                            "name": "name 1.1",
                        },
                        {
                            "id": "id_1_2",
                            "name": "name 1.2",
                        },
                    ]
                },
                {
                    "id": "id_2",
                    "name": "name 2",
                }
            ]
        };
        var lectLst;
        lectLst = [{
            "path": "p1/p2long txt long txt long txtlong long txt long txt long txtlong txtlong txtlong txtlong txt/p3/t1 long txt long txt long txtlong txtlong txtlong txtlong txt",
            "ID": "2",
            "created": "01/01/2019",
            "title": "bai giang 1",
            "topic": "chu de 2",
            "target": "doi tuong 1",
            "author": "su ong",
            "content": "noi dung",
            "link": "file:///C:/Users/Khiem/Downloads/movie/Harry.Potter.and.the.Deathly.Hallows.Part.1.2010.mp4"
        },
        {
            "path": "p1/p2long txt long txt long txtlong long txt long txt long txtlong txtlong txtlong txtlong txt/p3/t2",
            "ID": "3",
            "created": "02/01/2019",
            "title": "bai giang 2",
            "topic": "chu de 2",
            "target": "doi tuong 2",
            "author": "su phu",
            "content": "noi dung",
            "link": "https://www.youtube.com/watch?v=HQ1lFe9I0lo"
        },
        {

            "path": "p1/p2/p3/t3",
            "ID": "4",
            "created": "03/01/2019",
            "title": "bai giang 3",
            "topic": "chu de 3",
            "target": "doi tuong 3",
            "author": "su phu",
            "content": "noi dung",
            "link": "file:///D:/music/nhac%20niem%20phat/Nammobotatquantheam.mp3"
        }
        ];
        //var g_nodesDict={};
        //var baseUrl = window.location.href.replace(/\/[^/]*\.html/,"");
        //var imgSrc = {
        //  "expand":baseUrl+"/expand_button.png",
        //  "colapse":baseUrl+"/collapse_button.png",
        //  "noop":baseUrl+"/noop_button.png",
        //  "checked":baseUrl+"/sts_checked.png",
        //  "uncheck":baseUrl+"/sts_uncheck.png",
        //  "gray":baseUrl+"/sts_gray.png",  
        //};

        var rootNode = {
            "id": "root",
            "name": "root",
            "childs": [],
        };

        var lectItem = {
            "author": "author 2",
            "target": "target 1",
            "topic": "topic 2",
            "title": "title 2.1.1.6",
        };

        //main//////////////////////////////////////
        //render tree
        var jsTxt = null;
        if (jsTxt != null) {
            lectLst = jsTxt;
            document.getElementById("id_content").innerHTML = "";
        }
        var url = "https://localhost:44336/api/Lectures";
        url = "https://localhost:5001/api/Lectures";
        //lectLst = getLecturesSync(url); //only work on IE 11
        render1(lectLst);
		//render3(url);
    </script>
    <script>
        function onImgClick(nodeId) {
            var tNode = g_nodesDict[nodeId];
            if (tNode.childs == null) return;

            var tImg = document.getElementById(nodeId + "_img");
            var tDiv = document.getElementById(nodeId + "_childs");
            tNode.visible = !tNode.visible;
            if (tNode.visible == true) {
                //tImg.src = imgSrc.colapse;
                tImg.textContent = imgSrc.colapse;
                tDiv.hidden = false;
                stsDelColapsed(nodeId);
                stsSave();
            } else {
                //tImg.src = imgSrc.expand;
                tImg.textContent = imgSrc.expand;
                tDiv.hidden = true;
                stsAddColapsed(nodeId);
                stsSave();
            }
        }
        function onStsClick(nodeId) {
            var tNode = g_nodesDict[nodeId];

            if (tNode.sts == 1) {
                tNode.sts = 0;
            } else {
                tNode.sts = 1;
            }
            updateStsImg(tNode);
            updateChildSts(tNode);
            updateParentSts(tNode.parent, tNode.sts);

            //display selected
            //var tLst = getSelected(rootNode);
            //displayLect(tLst);

            //save selected title id
            var sels = [];
            for (var i in g_nodesDict) {
                tNode = g_nodesDict[i];
                if (tNode.sts == 1 && tNode.lect != null) {
                    sels.push(tNode.lect.ID);
                }
            }
            stsSetSelected(sels);
            stsSave();
        }

        function getSelected(rootNode) {
            var queue = [];
            if (rootNode.sts != 0) queue.push(rootNode);
            var leafs = [];
            while (queue.length > 0) {
                var tNode = queue.shift();
                if (tNode.childs == null) {
                    leafs.push(tNode.lect);
                } else {
                    for (var i in tNode.childs) {
                        if (tNode.childs[i].sts != 0) queue.push(tNode.childs[i]);
                    }
                }
            }
            return leafs;
        }

        function onSpanClick(nodeId) {
            var tNode = g_nodesDict[nodeId];
            if (tNode.lect == null) return;

            var titleId = tNode.lect.ID;
            //var src = baseUrl + "/" + titleId + ".html";
            //show("iframe2", true);
            //document.getElementById("iframe2").src = "titles/" + titleId + ".html";
            var tDiv = document.getElementById("id_content");
            renderTitle(tNode.lect.paragraphs, tDiv);

            menuShowHide();
            stsSetCurTitle(tNode.lect.ID);
            stsSave();
        }

        function renderTitle(pars, tDiv) {
            tDiv.textContent = "";
            for (var i in pars) {
                var par = pars[i];
                var el = document.createElement("p");
                if (par.alignment == 1) {
                    el.style.textAlign = 'center';
                }
                if (par.fontBold == -1) {
                    el.style.fontWeight = "bold";
                }
                if (par.fontItalic == -1) {
                    el.style.fontStyle = "italic";
                }
                el.style.paddingLeft = par.leftIndent;
                el.innerText = par.content.replace(/\u000b/g, '\r');
                tDiv.appendChild(el);
            }
        }
    </script>
    <script src='https://code.responsivevoice.org/responsivevoice.js'></script>
    <script>
        //text to speek
        var g_speekState = 0; //stoped

        function onPlayContent() {
            var btn = document.getElementById("id_playContent");
            var spn = document.getElementById("id_playContentSts");
            switch (g_speekState) {
                case 0: //stoped ->play
                    spn.innerText = "playing";
                    g_speekState = 1;
                    var txt = document.getElementById("id_content").innerText;
                    playSpeek(txt);
                    btn.textContent = "⏸️";
                    break;
                case 1: //play ->pause
                    spn.innerHTML = "paused&nbsp;";
                    g_speekState = 2;
                    pauseSpeek();
                    //btn.innerText = "⏯️";
                    btn.textContent = "⏯️";
                    break;
                case 2: //pause ->play
                    spn.innerText = "playing";
                    g_speekState = 1;
                    resumeSpeek();
                    btn.innerHTML = "⏸️";
                    break;
            }
        }
        function onStopSpeek() {
            var btn = document.getElementById("id_playContent");
            var spn = document.getElementById("id_playContentSts");
            switch (g_speekState) {
                case 1:
                case 2:
                case 3:
                    spn.innerHTML = "stoped&nbsp;";
                    g_speekState = 0;
                    stopSpeek();
                    btn.textContent = "⏯️";
                    break;
            }
        }
        function onSpeedBegin() {
            //alert("onbegin");
        }
        function onSpeekEnd() {
            //alert("onend");
            onStopSpeek();
        }
        function pauseSpeek() {
            responsiveVoice.pause();
        }
        function resumeSpeek() {
            responsiveVoice.resume();
        }
        function stopSpeek() {
            responsiveVoice.cancel();
        }
        function playSpeek(txt) {
            var parameters = {
                onstart: onSpeedBegin,
                onend: onSpeekEnd
            }
            responsiveVoice.speak(txt, "Vietnamese Female", parameters);
        }
    </script>
    <script>
        //show hide menu
        var menuVisible = true;
        function menuShowHide() {
            menuVisible = !menuVisible;
            var tdiv = document.getElementById("id_menu");
            if (menuVisible) {
                tdiv.style.display = "table-cell";
            } else {
                tdiv.style.display = "none";
            }
        }
    </script>
    <script>
        //main part1//////////
        //hide frame
        var m_scale = 3 / 4;;
        //show("player", false);
        //show("mp4player", false);
        //show("mp3player", false);
        //document.getElementById("log").innerHTML = "browser: " + who();

        //lecture
        //displayLect(lectLst);
    </script>
    <script>
        function displayLect(lectLst) {
            var jsObj = {
                "cols": ["tieu de", "người giảng", "doi tuong", "chu de", "ngày", "noi dung", "link"],
                "recs": lectLst,
            };

            var txt = "";
            txt += '<table style="width: 100%;">';
            txt += "<tr>";
            var cols = jsObj.cols;
            var i;
            for (i in cols) {
                txt += '<th class="col1">' + cols[i] + '</th>';
            }
            txt += "</tr>";
            for (i in jsObj.recs) {
                rec = jsObj.recs[i];
                txt += "<tr>";
                txt += "<td>" + rec.title + "</td>";
                txt += "<td>" + rec.author + "</td>";
                txt += "<td>" + rec.target + "</td>";
                txt += "<td>" + rec.topic + "</td>";
                //txt += "<td>" + getDate(rec.created) + "</td>";
                txt += "<td>" + rec.content + "</td>";
                //txt += "<td>" + genRef(i, rec.link) + "</td>";
                txt += "</tr>";
            }
            txt += "</table>";
            document.getElementById("lectTbl").innerHTML = txt;
        }

        function genRef(i, lnk) {
            var m = lnk.match(/(\.mp4$|\.mp3$|youtube\.com)/i);
            var lbl = "link";
            if (m != null) {
                lbl = m[0];
            }
            btnid = "btn" + i;
            txt = '<span class="lnkBtn" onclick="jsfunction(' + "'" + btnid + "," + lnk + "'" + ')"  id="' + btnid + '" >' + lbl + '</span>';
            return txt;
        }

        function jsfunction(arg) {
            arr = arg.split(",");
            var id = arr[0];
            var lnk = arr[1];

            //check browser
            //str = who();
            //n = str.search(/Chrome|Edge|Firefox|Netscape/i)
            var n = 0;
            if (n == -1) {
                document.getElementById("log").innerHTML = "Can not play: [" + lnk + "] on " + str;
                return;
            }

            var lnkObj = getLnkObj(lnk);

            switch (lnkObj.lnkType) {
                case "mp4":
                    //play file.mp4
                    show("player", false);
                    show("mp4player", true);
                    show("mp3player", false);
                    document.getElementById("video1").src = lnkObj.lnk;
                    break;
                case "mp3":
                    //play file.mp3
                    show("player", false);
                    show("mp4player", false);
                    show("mp3player", true);
                    document.getElementById("audio1").src = lnkObj.lnk;
                    break;
                case "youtube":
                    show("player", true);
                    show("mp4player", false);
                    show("mp3player", false);
                    resize("frame1", 720);
                    document.getElementById("frame1").src = lnkObj.lnk + "?autoplay=1";
                    break;
            }
            document.getElementById("log").innerHTML = "playing:" + lnkObj.lnk;
        }
    </script>
    <script>
        //mainx1() - part x1
        document.getElementById("id_gotoTopBtn").style.display = "none";
        window.onscroll = onScroll;
        document.getElementById("id_content").onscroll = onscroll;
        //scroll
        function onScroll(e) {
            var h = e.target.scrollHeight;
            var t = e.target.scrollTop;
            var show = ((t * 100 / h) > 50);
            if (show) {
                document.getElementById("id_gotoTopBtn").style.display = "block";
            }
            else {
                document.getElementById("id_gotoTopBtn").style.display = "none";
            }
        }
        function gotoTop() {
            document.getElementById("id_content").scrollTop = 0;
        }
    </script>
    <script>
        //adjust ctrl pos
        function adjCtrlsPos() {
            adjTopCtrlsPos();
            adjContentPos();
            adjMenuPos();
        }

        function adjTopCtrlsPos() {
            var d = document.getElementById("id_topCtrls");
            d.style.width = document.body.offsetWidth - 10 + "px";

        }
        function adjContentPos() {
            var d_topCtrls = document.getElementById("id_topCtrls");
            var d = document.getElementById("id_content");
            d.style.top = d_topCtrls.offsetTop + d_topCtrls.offsetHeight;
            d.style.width = document.body.clientWidth - 10 + "px";
        }
        function adjMenuPos() {
            var d_topCtrls = document.getElementById("id_topCtrls");
            var d = document.getElementById("id_menu");
            d.style.top = d_topCtrls.offsetTop + d_topCtrls.offsetHeight;
        }
    </script>
    <script>
        //mainx2() - part x2
        var g_ratio = window.devicePixelRatio || 1;
        //document.getElementById("log").innerText = "ration:" + ratio;
        adjFont(g_ratio);
        //adjMenuSize(g_ratio);
        window.onresize = ctrlsResize;
        //ctrlsResize();

        function ctrlsResize() {
            var cw = document.body.clientWidth;
            var ch = document.body.clientHeight;
            var l = 5;
            var r = 5;
            var t = 5;
            var b = 5;
            //top ctrls
            w = cw - l - r;
            var topctrls = document.getElementById("id_topCtrls");
            topctrls.style.top = t;
            topctrls.style.left = l;
            topctrls.style.width = w;
            //menu
            t += topctrls.offsetHeight;
            h = ch - t - b;
            var menu = document.getElementById("id_menu");
            menu.style.top = t;
            menu.style.height = h;
            menu.style.width = (g_ratio < 1.5) ? 0.4 * w : 0.8 * w;
            //content
            var cont = document.getElementById("id_content");
            cont.style.left = l;
            cont.style.width = w;
            cont.style.height = h;
            //bot ctrls
            var botctrls = document.getElementById("id_botCtrls");
            botctrls.style.right = r;
            botctrls.style.bottom = b;
            //goto top btn
            var gtbtn = document.getElementById("id_gotoTopBtn")
            gtbtn.style.right = r;
            gtbtn.style.bottom = b + botctrls.offsetHeight;
        }

        //function adjMenuSize(ratio) {
        //    var m = document.getElementById("id_menu");
        //    var w = document.body.clientWidth;
        //    if (ratio < 1.5) {
        //        w = 0.4 * w;
        //    } else {
        //        w = 0.8 * w;
        //    }
        //    m.style.width = w + 'px';
        //}

        //font adjust
        function onAdjFont() {
            adjFont(g_ratio);
        }
        function adjFont(ratio) {
            var el = document.getElementById("span1");
            var w = el.offsetWidth;
            var baseW = 87;
            var scale = baseW * 1000 / w * ratio;
            //document.getElementById("log").innerText += " scale:" + scale;
            chgFontSize(scale);
            ctrlsResize();
        }
        function decFont() {
            //document.getElementById("log").innerText += " decFont:";
            chgFontSize(900)
            ctrlsResize();
        }
        function incFont() {
            //document.getElementById("log").innerText += " incFont:";
            chgFontSize(1100)
            ctrlsResize();
        }

        function chgFontSize(scale) {
            for (var i in document.childNodes) {
                var child = document.childNodes[i];
                chgFontSizeR(child, scale);
            }
        }
        function chgFontSizeR(el, scale) {
            for (var i in el.childNodes) {
                var child = el.childNodes[i];
                chgFontSizeR(child, scale);
            }
            var id = el.id;
            if (id === undefined) return;
            if (id == "") return;

            var css = getComputedStyle(el, null);
            if (css != null) {
                var style = css.getPropertyValue("font-size");
                var size = parseFloat(style) * scale / 1000;
                el.style.fontSize = size + 'px';
            }
        }
        function getScreenSizeInfo() {
            var ratio = window.devicePixelRatio || 1;
            var is_touch_device = 'ontouchstart' in document.documentElement;
            var touch_status = (is_touch_device) ? 'touch' : 'no-touch';
            touch_status = ' ts:' + touch_status;
            var width_height = 'wh:' + screen.width + 'x' + screen.height;
            var client_width_height = ' cwh:' + document.documentElement.clientWidth + 'x' + document.documentElement.clientHeight;
            var rw = screen.width * ratio;
            var rh = screen.height * ratio;
            var ratio_width_height = ' r:' + ratio + ' rwh:' + rw + 'x' + rh;
            var data_string = width_height + client_width_height + ratio_width_height + touch_status;
            return data_string;
        }
    </script>
    <script>
        //cookie
        var g_stsData = {
            "selTitles": [],
            "curTitle": 0,
            "collapsedLst": [],
        };
        restore();

        function restore() {
            stsRestore();

            //selected
            var sels = g_stsData.selTitles;
            for (var i in sels) {
                var id = sels[i];
                var tNode = g_titlesDict[id];
                //onStsClick(node.id);
                if (tNode.sts == 1) {
                    tNode.sts = 0;
                } else {
                    tNode.sts = 1;
                }
                updateStsImg(tNode);
                updateChildSts(tNode);
                updateParentSts(tNode.parent, tNode.sts);
            }
            //current title
            if (g_stsData.curTitle != 0) {
                var tNode = g_titlesDict[g_stsData.curTitle];
                var tDiv = document.getElementById("id_content");
                renderTitle(tNode.lect.paragraphs, tDiv);
            }
            //collapsed
            var clps = g_stsData.collapsedLst;
            for (var i in clps) {
                var nodeId = clps[i];
                var tNode = g_nodesDict[nodeId];
                tNode.visible = false;
                var tDiv = document.getElementById(nodeId + "_childs");
                var tImg = document.getElementById(nodeId + "_img");
                tImg.textContent = imgSrc.expand;
                tDiv.hidden = true;
            }

        }

        function stsAddColapsed(nodeId) {
            //var tDict = g_stsData.colapsedDict;
            //tDict[node.id] = node;
            g_stsData.collapsedLst.push(nodeId);
        }
        function stsDelColapsed(nodeId) {
            //var tDict = g_stsData.colapsedDict;
            //delete tDict[node.id];
            lstRemove(g_stsData.collapsedLst, nodeId);
        }

        function stsSetCurTitle(id) {
            g_stsData.curTitle = id;
        }
        function stsSetSelected(sels) {
            g_stsData.selTitles = sels;
        }
        function stsAddSelected(id) {
            g_stsData.push(id);
        }
        function stsDelSelected(id) {
            var a = g_stsData.selTitles;
            for (var i in a) {
                if (a[i] == id) {
                    a.splice(i, 1);
                    break;
                }
            }
        }
        function stsRestore() {
            var a = document.cookie.split(";");
            if (a.length > 0) {
                g_stsData = JSON.parse(a[0]);
            }
        }
        function stsSave() {
            var txt = JSON.stringify(g_stsData);
            var dt = new Date();
            dt.setDate(dt.getDate() + 7);
            document.cookie = txt;
            document.cookie = "expires="+dt.toUTCString();
        }
        function lstRemove(a, id) {
            for (var i in a) {
                if (a[i] == id) {
                    a.splice(i, 1);
                    break;
                }
            }
        }
    </script>
</body>
</html>
