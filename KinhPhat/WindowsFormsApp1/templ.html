<html>
<head>
    <title></title>
    <meta charset="utf-8" />
    <style type="text/css">
        button:focus {
            outline:none;
        }
        button.miStsBtn {
            display: table-cell;
            padding: 0;
            margin: 0;
            margin-top: 2px;
            margin-left: 2px;
            margin-right: 2px;
            background-color: transparent;
            border: none;
            font-family: 'Arial Unicode MS';
            transform: scale(1.5,1.5);
        }

        button.miImgBtn {
            display: table-cell;
            padding: 0;
            margin: 0;
            margin-top: 0px;
            margin-left: 2px;
            margin-right: 2px;
            background-color: transparent;
            border: none;
            font-family: 'Arial Unicode MS';
            transform: scale(1.5,1.5);
        }

        span.miLabel:hover {
            color: blue;
            text-decoration: underline;
        }

        span.miLabel {
            padding: 0;
            padding-left: 2px;
            padding-right: 2px;
            margin: 0;
            display: table-cell;
        }

        div.menuItem {
            width: auto;
            display: table;
        }

        div.miChilds {
            margin-left: 10px;
        }
    </style>
    <style>
        div.topCtrls {
            position: fixed;
            top: 5px;
            padding: 5px;
            background-color: #808080;
            width: 100%;
        }

        div.menu {
            position: fixed;
            top: 50px;
            width: 400px;
            height: 100%;
            overflow: scroll;
            background-color: rgb(209, 209, 209);
            display: table-cell;
        }

        div.content {
            position: fixed;
            top: 50px;
            width: 100%;
            height: 100%;
            overflow: scroll;
            display: table-cell;
        }

        table, td {
            vertical-align: central;
            border-width: 0px;
            border-collapse: collapse;
        }

        button.fontBtn {
            font-family: 'MS Gothic';
        }

        button.playBtn {
            font-family: 'MS Gothic';
        }
    </style>
</head>
<body id="body" style="font-family: 'Times New Roman'; margin: 5px;">
    <div id="id_content" class="content">
        <p style="text-align: center">sentence</p>
        <p>sentence</p>
        <p>sentence</p>
        <p>sentence</p>
        <p>sentence</p>
        <p>sentence</p>
    </div>
    <button id="id_gotoTopBtn" onclick="gotoTop()" class="fontBtn" style="position: fixed; right: 2px; bottom: 2px">△</button>
    <div id="id_topCtrls" class="topCtrls">
        <table style="width: 100%; border-width: 0px; border-collapse: collapse">
            <tr>
                <td style="width: auto">
                    <button id="id_toggleMenuBtn" class="fontBtn" style="width: auto" onclick="menuShowHide()">目</button>
                </td>
                <td>
                    <span id="id_sutraTitle" style="white-space: nowrap; font-weight: bold">Ðại Tạng Kinh Việt Nam</span>
                </td>
                <td style="width: 100%"></td>
                <td>
                    <button id="fontInc" class="fontBtn" onclick="incFont()">＋</button>
                </td>
                <td>
                    <button id="fontDec" class="fontBtn" onclick="decFont()">―</button>
                </td>
                <td>
                    <button id="fontAdjBtn" class="fontBtn" onclick="onAdjFont()">〇</button>
                </td>
                <td>
                    <button id="printAll" class="fontBtn" onclick="printAll()">&#9113</button>
                </td>
            </tr>
        </table>
    </div>
    <div id="id_botCtrls" style="position: fixed; bottom: 10px; right: 10px">
        <span style="white-space: nowrap">
            <button class="playBtn" id="id_playContent" onclick="onPlayContent()">⏯️</button>
            <button class="playBtn" id="id_stopSpeek" onclick="onStopSpeek()">⏹️</button>
            <button class="playBtn" id="id_prevTitle" onclick="onPrevTitle()">⏮</button>
            <button class="playBtn" id="id_backward" onclick="onBackward()">⏪</button>
            <button class="playBtn" id="id_fastForward" onclick="onFastForward()">⏩</button>
            <button class="playBtn" id="id_nextTitle" onclick="onNextTitle()">⏭</button>
            <span id="id_playContentSts" style="font-family: 'MS Gothic'">stoped&nbsp;</span>
        </span>
    </div>
    <div id="id_menu" class="menu">
        <div id="root_childs" class="miChilds">
            <div class="menuItem">
                <button id="node1_img" class="miImgBtn" onclick="onImgClick('node1')">+</button>
                <button id="node1_sts" class="miStsBtn" onclick="onStsClick('node1')">□</button>
                <span id="node1_span" class="miLabel" onclick="onSpanClick('node1')">node1</span>
            </div>
            <div id="node1_childs" class="miChilds">
                <div class="menuItem">
                    <button id="node1_1_img" class="miImgBtn" onclick="onImgClick('node1')">+</button>
                    <button id="node1_1_sts" class="miStsBtn" onclick="onStsClick('node1')">□</button>
                    <span id="node1_1_span" class="miLabel" onclick="onSpanClick('node1')">node1.1</span>
                </div>
                <div id="node1_1_childs" class="miChilds">
                </div>
            </div>
            <div class="menuItem">
                <button id="node2_img" class="miImgBtn" onclick="onImgClick('node1')">+</button>
                <button id="node2_sts" class="miStsBtn" onclick="onStsClick('node1')">□</button>
                <span id="node2_span" class="miLabel" onclick="onSpanClick('node1')">node2</span>
            </div>
            <div id="node2_childs" class="miChilds">
            </div>
        </div>
    </div>
    <span id="log" style="color: gray" hidden="hidden">playing:</span>
    <script>
        //chk lnk is mp3, mp4 or youtube
        function getLnkObj(lnk) {
            var lnkType;
            if (lnk.search(/\.mp4$/i) != -1) {
                lnkType = "mp4";
            }
            else if (lnk.search(/\.mp3$/i) != -1) {
                lnkType = "mp3";
            }
            else {
                lnkType = "youtube";
                ytlnk = crtYTEmbed(lnk);
                if (ytlnk != '') {
                    lnk = ytlnk;
                }
            }
            return { "lnk": lnk, "lnkType": lnkType };
        }

        //get browser info
        function who() {
            var ua = navigator.userAgent, tem,
                M = ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i) || [];
            if (/trident/i.test(M[1])) {
                tem = /\brv[ :]+(\d+)/g.exec(ua) || [];
                return 'IE ' + (tem[1] || '');
            }
            if (M[1] === 'Chrome') {
                tem = ua.match(/\b(OPR|Edge)\/(\d+)/);
                if (tem != null) return tem.slice(1).join(' ').replace('OPR', 'Opera');
            }
            M = M[2] ? [M[1], M[2]] : [navigator.appName, navigator.appVersion, '-?'];
            if ((tem = ua.match(/version\/(\d+)/i)) != null) M.splice(1, 1, tem[1]);
            //return M.join(' ');
            return ua;
        }

        function crtYTEmbed(url) {
            var regExp = /^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|\&v=)([^#\&\?]*).*/;
            var match = url.match(regExp);

            if (match && match[2].length == 11) {
                return 'https://www.youtube.com/embed/' + match[2];
            } else {
                return '';
            }
        }
        function toggle(id) {
            var x = document.getElementById(id);
            if (x.style.display == "none") {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }

        //__in showhide: true-> show
        function show(id, showhide) {
            var x = document.getElementById(id);
            if (showhide) {
                x.style.display = "block";
            } else {
                x.style.display = "none";
            }
        }

        //video1 controls
        function playPause(id) {
            ctrl = document.getElementById(id);
            if (ctrl.paused)
                ctrl.play();
            else
                ctrl.pause();
        }

        function makeBig(id) {
            ctrl = document.getElementById(id);
            w = Math.min(ctrl.width * 1.1, 1080);
            resize(id, w);
        }

        function makeSmall(id) {
            ctrl = document.getElementById(id);
            w = Math.max(ctrl.width * 0.9, 360);
            resize(id, w);
        }

        function makeNormal(id) {
            resize(id, 480);
        }
        function resize(id, w) {
            ctrl = document.getElementById(id);
            ctrl.width = w;
            if (id == "frame1") {
                ctrl.height = w * m_scale;
            }
        }
    </script>
    <script>
        //init var part2///////
        //tree
        var g_nodesDict = {};
        var g_titlesDict = {};
        var baseUrl = window.location.href.replace(/\/[^/]*\.html/, "");
        var g_impSrc = {
            "expand": "▷", //"▷＋",
            "colapse": "▽", //"▽－",
            "noop": "　",
            "checked": "■",
            "uncheck": "□",
            "gray": "▣",
        };
    </script>
    <script>
        //tree
        // render item by item
        function render1(lectLst) {
            document.getElementById(g_rootNode.id + "_childs").innerHTML = "";
            g_rootNode.visible = true;

            for (var i in lectLst) {
                addLectItem(g_rootNode, lectLst[i]);
            }
        }

        // render hold tree
        function render2(lectLst) {
            for (var i in lectLst) {
                addNode(g_rootNode, lectLst[i]);
            }
            treeRender(g_rootNode);
        }

        // get data from web and render async
        function render3(url) {
            document.getElementById(g_rootNode.id + "_childs").innerHTML = "";
            g_rootNode.visible = true;

            //getItems();
            var xhttp = new XMLHttpRequest();
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    var jsTxt = xhttp.responseText;
                    var items = eval("(" + jsTxt + ")");
                    for (var i in items) {
                        var lectItem = items[i];
                        addLectItem(g_rootNode, lectItem);
                    }
                }
            };
            xhttp.open('GET', url, true);
            xhttp.send();
        }


        function getLecturesSync(url) {
            var xhttp = new XMLHttpRequest();
            xhttp.open('GET', url, false);
            xhttp.send();
            if (xhttp.status == 200) {
                return eval("(" + xhttp.responseText + ")");
            } else {
                return [];
            }
        }

        ////////////////////////////////////////////
        //function getItems() {
        //  var uri = "https://localhost:44336/api/Lectures";
        //  fetch(uri)
        //    .then(response => response.json())
        //    .then(data => _displayItems(data))
        //    .catch(error => console.error('Unable to get items.', error));
        //}
        //function _displayItems(data) {
        //  data.forEach(item => {
        //    addLectItem(rootNode,item);
        //  });
        //}
        ////////////////////////////////////////////
        //add lecture item to root node
        function addNode(root, lectItem) {
            var path = [lectItem.author, lectItem.target, lectItem.topic];
            var parent = root;
            var child;
            for (var i in path) {
                var name = path[i];
                if (parent.childs[name] != null) {
                    child = parent.childs[name];
                } else {
                    var id = parent.id + '_' + Object.keys(parent.childs).length;
                    child = {
                        "id": id,
                        "name": name,
                        "childs": [],
                    };
                    parent.childs[name] = child;
                }
                parent = child;
            }
            parent.childs[lectItem.title] = {
                "id": parent.id + '_' + lectItem.title,
                "name": lectItem.title,
                "lect": lectItem,
            };
        }

        //add and render lecture item
        function addLectItem(root, lectItem) {
            var path = lectItem.path.split('/');
            var parent = root;
            var child;
            var renderLst = [];
            for (var i in path) {
                var name = path[i];
                if (parent.childs[name] != null) {
                    child = parent.childs[name];
                } else {
                    var id = parent.id + '_' + Object.keys(parent.childs).length;
                    child = {
                        "id": id,
                        "name": name,
                        "childs": [],
                    };
                    parent.childs[name] = child;

                    //add to render lst
                    renderLst.push([parent, child]);
                }
                parent = child;
            }

            child.childs = null;
            child.lect = lectItem;
            g_titlesDict[lectItem.ID] = child;  //for restore sts

            //render nodes
            for (var i in renderLst) {
                parent = renderLst[i][0];
                child = renderLst[i][1];
                treeAdd(parent, child);
                g_nodesDict[child.id] = child;
            }
        }

        function treeRender(rootNode) {
            document.getElementById(rootNode.id + "_childs").innerHTML = "";
            rootNode.visible = true;
            treeAddR(rootNode);
        }
        function treeAddR(parentNode) {
            var i;
            for (i in parentNode.childs) {
                var childNode = parentNode.childs[i];
                treeAdd(parentNode, childNode);
                g_nodesDict[childNode.id] = childNode;
                treeAddR(childNode);
            }
        }
        function treeAdd(parentNode, childNode) {
            //init node
            childNode.parent = parentNode;
            childNode.sts = 0;  //uncheck
            childNode.visible = true;

            //var imgTxt = '<img id="[nodeId]_img" class="toggleImg" src="[imgSrc]" onclick="onImgClick(' + "'[nodeId]'" + ')"></img>';
            //imgTxt = imgTxt.replace(/\[nodeId\]/g, childNode.id);
            //imgTxt = imgTxt.replace(/\[imgSrc\]/g, imgSrc.colapse);
            //if (childNode.childs == null) {
            //    imgTxt = '<img src="' + imgSrc.noop + '" ></img>'
            //}
            var img1 = document.createElement("button");
            img1.id = childNode.id + "_img";
            img1.className = "miImgBtn";
            img1.textContent = g_impSrc.colapse;
            if (childNode.childs == null) { img1.textContent = g_impSrc.noop };
            img1.onclick = function () { onImgClick(childNode.id) };

            //var stsTxt = '<img id="[nodeId]_sts" class="stsImg" src="[stsSrc]" onclick="onStsClick(' + "'[nodeId]'" + ')"></img>';
            //stsTxt = stsTxt.replace(/\[nodeId\]/g, childNode.id);
            //stsTxt = stsTxt.replace(/\[stsSrc\]/g, g_impSrc.uncheck);
            var sts1 = document.createElement("button");
            sts1.id = childNode.id + "_sts";
            sts1.className = "miStsBtn";
            sts1.textContent = g_impSrc.uncheck;
            sts1.onclick = function () { onStsClick(childNode.id) };

            //var spanTxt = '<span id="[nodeId]_span" class="txtbtn" onclick="onSpanClick(' + "'[nodeId]'" + ')">[nodeName]</span><br>';
            //spanTxt = spanTxt.replace(/\[nodeId\]/g, childNode.id);
            //spanTxt = spanTxt.replace(/\[nodeName\]/g, childNode.name);
            var span1 = document.createElement("span");
            span1.id = childNode.id + "_span";
            span1.className = "miLabel";
            span1.textContent = childNode.name;
            span1.onclick = function () { onSpanClick(childNode.id) };

            var div1 = document.createElement("div");
            div1.className = "menuItem";
            //var span11 = document.createElement("span");
            //span11.appendChild(img1);
            //span11.appendChild(sts1);
            //div1.appendChild(span11);
            //div1.appendChild(img1);
            //div1.appendChild(sts1);
            //div1.appendChild(span1);

            var tbl = document.createElement("table");
            var tr = document.createElement("tr");
            tbl.appendChild(tr);
            var td = document.createElement("td");
            td.appendChild(img1);
            tr.append(td);
            var td = document.createElement("td");
            td.appendChild(sts1);
            tr.append(td);
            var td = document.createElement("td");
            tr.append(td);
            td.appendChild(span1);
            div1.append(tbl);

            //var divTxt = '<div id="[nodeId]_childs" class="childsDiv">';
            //divTxt = divTxt.replace(/\[nodeId\]/g, childNode.id);
            var div2 = document.createElement("div");
            div2.className = "miChilds";
            div2.id = childNode.id + "_childs";

            var tDiv = document.getElementById(parentNode.id + "_childs");
            //tDiv.innerHTML += imgTxt + stsTxt + spanTxt + divTxt;
            tDiv.appendChild(div1);
            tDiv.appendChild(div2);
        }
        function updateChildSts(tNode) {
            var childs = tNode.childs;
            var sts = tNode.sts;
            var i;
            for (i in childs) {
                var childNode = childs[i];
                childNode.sts = sts;
                updateStsImg(childNode);

                updateChildSts(childNode);
            }
        }
        function updateParentSts(tNode, sts) {
            if (tNode.id == "root") return;
            var childs = tNode.childs;
            if (sts != 2) {
                for (var i in childs) {
                    var childNode = childs[i];
                    if (childNode.sts != sts) {
                        sts = 2;
                        break;
                    }
                }
            }
            tNode.sts = sts;
            updateStsImg(tNode);

            //recursive
            updateParentSts(tNode.parent, sts);
        }

        function updateStsImg(tNode) {
            var src;
            switch (tNode.sts) {
                case 0:
                    src = g_impSrc.uncheck;
                    //if (tNode.lect != null) {
                    //    alert("ucheck:" + tNode.lect.ID)
                    //}
                    break;
                case 1:
                    src = g_impSrc.checked;
                    //if (tNode.lect != null) {
                    //    alert("check:" + tNode.lect.ID)
                    //}
                    break;
                default:
                    src = g_impSrc.gray;
            }
            var tImg = document.getElementById(tNode.id + "_sts");
            //tImg.src = src;
            tImg.textContent = src;
        }

        //"2018-04-10T04:00:00.000Z"
        function getDate(zTxt) {
            return zTxt.match(/.*(?=T)/);
        }
    </script>
    <script>
        //var init///////////////////////
        var nodeLst = {
            "id": "root",
            "name": "root node",
            "childs": [
                {
                    "id": "id_1",
                    "name": "name 1",
                    "childs": [
                        {
                            "id": "id_1_1",
                            "name": "name 1.1",
                        },
                        {
                            "id": "id_1_2",
                            "name": "name 1.2",
                        },
                    ]
                },
                {
                    "id": "id_2",
                    "name": "name 2",
                }
            ]
        };
        var g_lectLst;
        g_lectLst = [{
            "path": "p1/p2long txt long txt long txtlong long txt long txt long txtlong txtlong txtlong txtlong txt/p3/t1 long txt long txt long txtlong txtlong txtlong txtlong txt",
            "ID": "2",
            "created": "01/01/2019",
            "title": "bai giang 1",
            "topic": "chu de 2",
            "target": "doi tuong 1",
            "author": "su ong",
            "content": "noi dung",
            "link": "file:///C:/Users/Khiem/Downloads/movie/Harry.Potter.and.the.Deathly.Hallows.Part.1.2010.mp4"
        },
        {
            "path": "p1/p2long txt long txt long txtlong long txt long txt long txtlong txtlong txtlong txtlong txt/p3/t2",
            "ID": "3",
            "created": "02/01/2019",
            "title": "bai giang 2",
            "topic": "chu de 2",
            "target": "doi tuong 2",
            "author": "su phu",
            "content": "noi dung",
            "link": "https://www.youtube.com/watch?v=HQ1lFe9I0lo"
        },
        {

            "path": "p1/p2/p3/t3",
            "ID": "4",
            "created": "03/01/2019",
            "title": "bai giang 3",
            "topic": "chu de 3",
            "target": "doi tuong 3",
            "author": "su phu",
            "content": "noi dung",
            "link": "file:///D:/music/nhac%20niem%20phat/Nammobotatquantheam.mp3"
        }
        ];
        //var g_nodesDict={};
        //var baseUrl = window.location.href.replace(/\/[^/]*\.html/,"");
        //var g_impSrc = {
        //  "expand":baseUrl+"/expand_button.png",
        //  "colapse":baseUrl+"/collapse_button.png",
        //  "noop":baseUrl+"/noop_button.png",
        //  "checked":baseUrl+"/sts_checked.png",
        //  "uncheck":baseUrl+"/sts_uncheck.png",
        //  "gray":baseUrl+"/sts_gray.png",  
        //};

        var g_rootNode = {
            "id": "root",
            "name": "root",
            "childs": [],
        };

        var lectItem = {
            "author": "author 2",
            "target": "target 1",
            "topic": "topic 2",
            "title": "title 2.1.1.6",
        };

        //main//////////////////////////////////////
        //render tree
        var jsTxt = null;
        if (jsTxt != null) {
            g_lectLst = jsTxt;
            document.getElementById("id_content").innerHTML = "";
        }
        var url = "https://localhost:44336/api/Lectures";
        url = "https://localhost:5001/api/Lectures";
        //g_lectLst = getLecturesSync(url); //only work on IE 11
		//render3(url);
    </script>
    <script>
        function onImgClick(nodeId) {
            var tNode = g_nodesDict[nodeId];
            if (tNode.childs == null) return;

            var tImg = document.getElementById(nodeId + "_img");
            var tDiv = document.getElementById(nodeId + "_childs");
            tNode.visible = !tNode.visible;
            if (tNode.visible == true) {
                //tImg.src = g_impSrc.colapse;
                tImg.textContent = g_impSrc.colapse;
                tDiv.hidden = false;
                stsDelColapsed(nodeId);
                stsSave();
            } else {
                //tImg.src = g_impSrc.expand;
                tImg.textContent = g_impSrc.expand;
                tDiv.hidden = true;
                stsAddColapsed(nodeId);
                stsSave();
            }
        }
        function onStsClick(nodeId) {
            var tNode = g_nodesDict[nodeId];

            if (tNode.sts == 1) {
                tNode.sts = 0;
            } else {
                tNode.sts = 1;
            }
            updateStsImg(tNode);
            updateChildSts(tNode);
            updateParentSts(tNode.parent, tNode.sts);

            //display selected
            //var tLst = getSelected(rootNode);
            //displayLect(tLst);

            //save selected title id
            var sels = [];
            for (var i in g_nodesDict) {
                tNode = g_nodesDict[i];
                if (tNode.sts == 1 && tNode.lect != null) {
                    sels.push(tNode.lect.ID);
                }
            }
            stsSetSelected(sels);
            stsSave();
        }

        function getSelected(rootNode) {
            var queue = [];
            if (rootNode.sts != 0) queue.push(rootNode);
            var leafs = [];
            while (queue.length > 0) {
                var tNode = queue.shift();
                if (tNode.childs == null) {
                    leafs.push(tNode.lect);
                } else {
                    for (var i in tNode.childs) {
                        if (tNode.childs[i].sts != 0) queue.push(tNode.childs[i]);
                    }
                }
            }
            return leafs;
        }

        function onSpanClick(nodeId) {
            var tNode = g_nodesDict[nodeId];
            if (tNode.lect == null) return;

            var titleId = tNode.lect.ID;
            //var src = baseUrl + "/" + titleId + ".html";
            //show("iframe2", true);
            //document.getElementById("iframe2").src = "titles/" + titleId + ".html";
            var tDiv = document.getElementById("id_content");
            renderTitle(tNode.lect.paragraphs, tDiv);
            g_playingTitle = tNode.lect;
            g_playingPar = 0;

            menuShowHide();
            stsSetCurTitle(tNode.lect.ID);
            stsSave();
        }

        function renderTitle(pars, tDiv) {
            tDiv.textContent = "";
            for (var i in pars) {
                var par = pars[i];
                var el = document.createElement('p');
                if (par.alignment == 1) {
                    el.style.textAlign = 'center';
                } else if (par.alignment == 2) {
                    el.style.textAlign = 'right';
                }
                if (par.fontBold == -1) {
                    el.style.fontWeight = 'bold';
                }
                if (par.fontItalic == -1) {
                    el.style.fontStyle = 'italic';
                }
                el.style.paddingLeft = par.leftIndent;
                el.innerText = par.content.replace(/\u000b/g, '\r');
                tDiv.appendChild(el);
            }
        }
    </script>
    <script src='https://code.responsivevoice.org/responsivevoice.js'></script>
    <script>
        //text to speek
        var g_speekState = 0; //stoped
        var g_playingTitle = null;
        var g_playingPar = 0;

        function onPlayContent() {
            //g_playingPar = 0;
            PlayContent();
        }
        function onFastForward() {
            StopSpeek();
            g_playingPar = g_playingPar + 1;
            if (g_playingPar < g_playingTitle.paragraphs.length) {
                PlayContent();
            } else {
                //g_playingPar = 0;
            }
        }
        function onBackward() {
            StopSpeek();
            g_playingPar = g_playingPar - 1;
            if (g_playingPar < 0) {
                g_playingPar = 0;
            }
            PlayContent();
        }
        function onNextTitle() {
            StopSpeek();
            g_playingPar = g_playingTitle.paragraphs.length - 1;
            PlayContent();
        }
        function onPrevTitle() {
            StopSpeek();
            g_playingPar = 0;
            PlayContent();
        }
        function PlayContent() {
            var btn = document.getElementById("id_playContent");
            var spn = document.getElementById("id_playContentSts");
            switch (g_speekState) {
                case 0: //stoped ->play
                    spn.innerText = getPlayStsMsg(1);
                    g_speekState = 1;
                    //var txt = document.getElementById("id_content").innerText;
                    var txt = g_playingTitle.paragraphs[g_playingPar].content.replace(/\u000b/g, '\r');
                    playSpeek(txt);
                    btn.textContent = "⏸️";
                    parScroll(g_playingPar);    //auto scroll
                    break;
                case 1: //play ->pause
                    spn.innerHTML = getPlayStsMsg(2);
                    g_speekState = 2;
                    pauseSpeek();
                    //btn.innerText = "⏯️";
                    btn.textContent = "⏯️";
                    break;
                case 2: //pause ->play
                    spn.innerText = getPlayStsMsg(1);
                    g_speekState = 1;
                    resumeSpeek();
                    btn.innerHTML = "⏸️";
                    break;
            }
        }
        function getPlayStsMsg(mode) {
            var msg = ""
            switch (mode) {
                case 1: //playing
                    msg = "playing";
                    break;
                case 2: //pause
                    msg = "paused&nbsp;"
                    break;
                case 0: //stop
                    msg = "stoped&nbsp;"
                    break;
            }
            return msg + ':' + g_playingPar + '/' + g_playingTitle.paragraphs.length;
        }
        function onStopSpeek() {
            StopSpeek();
        }
        function StopSpeek() {
            var btn = document.getElementById("id_playContent");
            var spn = document.getElementById("id_playContentSts");
            switch (g_speekState) {
                case 1:
                case 2:
                case 3:
                    spn.innerHTML = getPlayStsMsg(0);
                    g_speekState = 0;
                    stopSpeek();
                    btn.textContent = "⏯️";
                    break;
            }
        }
        function onSpeedBegin() {
            //alert("onbegin");
        }
        function onSpeekEnd() {
            //alert("onend");
            g_playingPar = g_playingPar + 1;
            StopSpeek();
            if (g_playingPar < g_playingTitle.paragraphs.length) {
                PlayContent();
            } else {
                //g_playingPar = 0;
            }
        }
        function pauseSpeek() {
            responsiveVoice.pause();
        }
        function resumeSpeek() {
            responsiveVoice.resume();
        }
        function stopSpeek() {
            responsiveVoice.cancel();
        }
        function playSpeek(txt) {
            var parameters = {
                onstart: onSpeedBegin,
                onend: onSpeekEnd
            }
            responsiveVoice.speak(txt, "Vietnamese Female", parameters);
        }
        function parScroll(parIndex) {
            var d = document.getElementById("id_content");
            var p = d.childNodes[parIndex];
            d.scrollTop = p.offsetTop;
        }
        //on content scroll ->display par
        function displayReadingPar() {
            if (g_speekState != 0) return;
            var d = document.getElementById("id_content");
            for (var i in d.childNodes) {
                var p = d.childNodes[i];
                if (d.scrollTop <= p.offsetTop) {
                    var spn = document.getElementById("id_playContentSts");
                    g_playingPar = parseInt(i);
                    spn.innerHTML = getPlayStsMsg(0);
                    break;
                }
            }
        }
    </script>
    <script>
        //show hide menu
        var menuVisible = true;
        function menuShowHide() {
            menuVisible = !menuVisible;
            var tdiv = document.getElementById("id_menu");
            if (menuVisible) {
                tdiv.style.display = "table-cell";
            } else {
                tdiv.style.display = "none";
            }
        }
    </script>
    <script>
        //main part1//////////
        //hide frame
        var m_scale = 3 / 4;;
        //show("player", false);
        //show("mp4player", false);
        //show("mp3player", false);
        //document.getElementById("log").innerHTML = "browser: " + who();

        //lecture
        //displayLect(g_lectLst);
    </script>
    <script>
        function displayLect(lectLst) {
            var jsObj = {
                "cols": ["tieu de", "người giảng", "doi tuong", "chu de", "ngày", "noi dung", "link"],
                "recs": lectLst,
            };

            var txt = "";
            txt += '<table style="width: 100%;">';
            txt += "<tr>";
            var cols = jsObj.cols;
            var i;
            for (i in cols) {
                txt += '<th class="col1">' + cols[i] + '</th>';
            }
            txt += "</tr>";
            for (i in jsObj.recs) {
                rec = jsObj.recs[i];
                txt += "<tr>";
                txt += "<td>" + rec.title + "</td>";
                txt += "<td>" + rec.author + "</td>";
                txt += "<td>" + rec.target + "</td>";
                txt += "<td>" + rec.topic + "</td>";
                //txt += "<td>" + getDate(rec.created) + "</td>";
                txt += "<td>" + rec.content + "</td>";
                //txt += "<td>" + genRef(i, rec.link) + "</td>";
                txt += "</tr>";
            }
            txt += "</table>";
            document.getElementById("lectTbl").innerHTML = txt;
        }

        function genRef(i, lnk) {
            var m = lnk.match(/(\.mp4$|\.mp3$|youtube\.com)/i);
            var lbl = "link";
            if (m != null) {
                lbl = m[0];
            }
            btnid = "btn" + i;
            txt = '<span class="lnkBtn" onclick="jsfunction(' + "'" + btnid + "," + lnk + "'" + ')"  id="' + btnid + '" >' + lbl + '</span>';
            return txt;
        }

        function jsfunction(arg) {
            arr = arg.split(",");
            var id = arr[0];
            var lnk = arr[1];

            //check browser
            //str = who();
            //n = str.search(/Chrome|Edge|Firefox|Netscape/i)
            var n = 0;
            if (n == -1) {
                document.getElementById("log").innerHTML = "Can not play: [" + lnk + "] on " + str;
                return;
            }

            var lnkObj = getLnkObj(lnk);

            switch (lnkObj.lnkType) {
                case "mp4":
                    //play file.mp4
                    show("player", false);
                    show("mp4player", true);
                    show("mp3player", false);
                    document.getElementById("video1").src = lnkObj.lnk;
                    break;
                case "mp3":
                    //play file.mp3
                    show("player", false);
                    show("mp4player", false);
                    show("mp3player", true);
                    document.getElementById("audio1").src = lnkObj.lnk;
                    break;
                case "youtube":
                    show("player", true);
                    show("mp4player", false);
                    show("mp3player", false);
                    resize("frame1", 720);
                    document.getElementById("frame1").src = lnkObj.lnk + "?autoplay=1";
                    break;
            }
            document.getElementById("log").innerHTML = "playing:" + lnkObj.lnk;
        }
    </script>
    <script>
        //scroll
        function onScroll(e) {
            var h = e.target.scrollHeight;
            var t = e.target.scrollTop;
            var show = ((t * 100 / h) > 50);
            if (show) {
                document.getElementById("id_gotoTopBtn").style.display = "block";
            }
            else {
                document.getElementById("id_gotoTopBtn").style.display = "none";
            }

            //display par no
            displayReadingPar();
        }
        function gotoTop() {
            document.getElementById("id_content").scrollTop = 0;
        }
    </script>
    <script>
        //adjust ctrl pos
        function adjCtrlsPos() {
            adjTopCtrlsPos();
            adjContentPos();
            adjMenuPos();
        }

        function adjTopCtrlsPos() {
            var d = document.getElementById("id_topCtrls");
            d.style.width = document.body.offsetWidth - 10 + "px";

        }
        function adjContentPos() {
            var d_topCtrls = document.getElementById("id_topCtrls");
            var d = document.getElementById("id_content");
            d.style.top = d_topCtrls.offsetTop + d_topCtrls.offsetHeight;
            d.style.width = document.body.clientWidth - 10 + "px";
        }
        function adjMenuPos() {
            var d_topCtrls = document.getElementById("id_topCtrls");
            var d = document.getElementById("id_menu");
            d.style.top = d_topCtrls.offsetTop + d_topCtrls.offsetHeight;
        }
    </script>
    <script>
        function ctrlsResize() {
            var cw = document.body.clientWidth;
            var ch = document.body.clientHeight;
            var l = 5;
            var r = 5;
            var t = 5;
            var b = 5;
            //top ctrls
            w = cw - l - r;
            var topctrls = document.getElementById("id_topCtrls");
            topctrls.style.top = t;
            topctrls.style.left = l;
            topctrls.style.width = w;
            //menu
            t += topctrls.offsetHeight;
            h = ch - t - b;
            var menu = document.getElementById("id_menu");
            menu.style.top = t;
            menu.style.height = h;
            menu.style.width = (g_ratio < 1.5) ? 0.4 * w : 0.8 * w;
            //content
            var cont = document.getElementById("id_content");
            cont.style.left = l;
            cont.style.width = w;
            cont.style.height = h;
            //bot ctrls
            var botctrls = document.getElementById("id_botCtrls");
            botctrls.style.right = r + 10;
            botctrls.style.bottom = b;
            //goto top btn
            var gtbtn = document.getElementById("id_gotoTopBtn")
            gtbtn.style.right = r;
            gtbtn.style.bottom = b + botctrls.offsetHeight;
        }

        //function adjMenuSize(ratio) {
        //    var m = document.getElementById("id_menu");
        //    var w = document.body.clientWidth;
        //    if (ratio < 1.5) {
        //        w = 0.4 * w;
        //    } else {
        //        w = 0.8 * w;
        //    }
        //    m.style.width = w + 'px';
        //}

        //font adjust
        function onAdjFont() {
            adjFont(g_ratio);
        }
        function adjFont(ratio) {
            var el = document.getElementById("id_sutraTitle");
            var w = el.offsetWidth;
            var key = el.innerText;
            var d = {
                "Ðại Tạng Kinh Việt Nam": [161, 170, 181],   //normal, bold, larger
            };
            var baseW = (d[key] != null) ? d[key][1] : w;
            var scale = baseW * 1000 / w * ratio;
            //document.getElementById("log").innerText += " scale:" + scale;
            chgFontSize(scale);
            ctrlsResize();
        }
        function decFont() {
            //document.getElementById("log").innerText += " decFont:";
            chgFontSize(900)
            ctrlsResize();
        }
        function incFont() {
            //document.getElementById("log").innerText += " incFont:";
            chgFontSize(1100)
            ctrlsResize();
        }

        function chgFontSize(scale) {
            //for (var i in document.childNodes) {
            //    var child = document.childNodes[i];
            //    chgFontSizeR(child, scale);
            //}
            chgFontSize2("button.miImgBtn", scale);
            chgFontSize2("button.miStsBtn", scale);
            chgFontSize2("button.fontBtn", scale);
            chgFontSize2("button.playBtn", scale);
            chgFontSize2("span.miLabel", scale);
            chgElementFontSize(document.body, scale);     //effect to all [span, p]
            //chgElementFontSize(document.getElementById("id_toggleMenuBtn"), scale);
            chgElementFontSize(document.getElementById("id_sutraTitle"), scale);
        }
        function chgFontSizeR(el, scale) {
            for (var i in el.childNodes) {
                var child = el.childNodes[i];
                chgFontSizeR(child, scale);
            }
            var id = el.id;
            if (id === undefined) return;
            if (id == "") return;

            var css = getComputedStyle(el, null);
            if (css != null) {
                var style = css.getPropertyValue("font-size");
                var size = parseFloat(style) * scale / 1000;
                el.style.fontSize = size + 'px';
            }
        }
        function getScreenSizeInfo() {
            var ratio = window.devicePixelRatio || 1;
            var is_touch_device = 'ontouchstart' in document.documentElement;
            var touch_status = (is_touch_device) ? 'touch' : 'no-touch';
            touch_status = ' ts:' + touch_status;
            var width_height = 'wh:' + screen.width + 'x' + screen.height;
            var client_width_height = ' cwh:' + document.documentElement.clientWidth + 'x' + document.documentElement.clientHeight;
            var rw = screen.width * ratio;
            var rh = screen.height * ratio;
            var ratio_width_height = ' r:' + ratio + ' rwh:' + rw + 'x' + rh;
            var data_string = width_height + client_width_height + ratio_width_height + touch_status;
            return data_string;
        }
        function chgFontSize2(className, scale) {
            var i = className.indexOf('.');
            var elClass = i == -1 ? className : className.substr(i + 1);
            var el = document.getElementsByClassName(elClass);
            var css = getComputedStyle(el[0], null);
            var style = css.getPropertyValue("font-size");
            var size = parseFloat(style) * scale / 1000;
            //el.style.fontSize = size + 'px';
            var rule = getStyleRule(className);
            rule.style['font-size'] = size + 'px';
        }
        function chgElementFontSize(el, scale) {
            var css = getComputedStyle(el, null);
            var style = css.getPropertyValue("font-size");
            var size = parseFloat(style) * scale / 1000;
            el.style.fontSize = size + 'px';
        }
        function chgTblFontSize(scale) {
            var els = document.getElementsByTagName("table");
            for (var i in els) {
                var el = els[i];
                var css = getComputedStyle(el, null);
                if (css == null) continue;
                var style = css.getPropertyValue("font-size");
                var size = parseFloat(style) * scale / 1000;
                el.style.fontSize = size + 'px';
            }
        }
    </script>
    <script>
        //cookie
        var g_stsData = {
            "selTitles": [],
            "curTitle": 0,
            "collapsedLst": [],
        };

        function ck_restore() {
            stsRestore();

            //selected
            var sels = g_stsData.selTitles;
            for (var i in sels) {
                var id = sels[i];
                var tNode = g_titlesDict[id];
                //onStsClick(node.id);
                if (tNode.sts == 1) {
                    tNode.sts = 0;
                } else {
                    tNode.sts = 1;
                }
                updateStsImg(tNode);
                updateChildSts(tNode);
                updateParentSts(tNode.parent, tNode.sts);
            }
            //current title
            if (g_stsData.curTitle != 0) {
                var tNode = g_titlesDict[g_stsData.curTitle];
                var tDiv = document.getElementById("id_content");
                renderTitle(tNode.lect.paragraphs, tDiv);
            }
            //collapsed
            var clps = g_stsData.collapsedLst;
            for (var i in clps) {
                var nodeId = clps[i];
                var tNode = g_nodesDict[nodeId];
                tNode.visible = false;
                var tDiv = document.getElementById(nodeId + "_childs");
                var tImg = document.getElementById(nodeId + "_img");
                tImg.textContent = g_impSrc.expand;
                tDiv.hidden = true;
            }

        }

        function stsAddColapsed(nodeId) {
            //var tDict = g_stsData.colapsedDict;
            //tDict[node.id] = node;
            g_stsData.collapsedLst.push(nodeId);
        }
        function stsDelColapsed(nodeId) {
            //var tDict = g_stsData.colapsedDict;
            //delete tDict[node.id];
            lstRemove(g_stsData.collapsedLst, nodeId);
        }

        function stsSetCurTitle(id) {
            g_stsData.curTitle = id;
        }
        function stsSetSelected(sels) {
            g_stsData.selTitles = sels;
        }
        function stsAddSelected(id) {
            g_stsData.push(id);
        }
        function stsDelSelected(id) {
            var a = g_stsData.selTitles;
            for (var i in a) {
                if (a[i] == id) {
                    a.splice(i, 1);
                    break;
                }
            }
        }
        function stsRestore() {
            var a = document.cookie.split(";");
            if (a.length > 1) {
                g_stsData = JSON.parse(a[0]);
            }
        }
        function stsSave() {
            var txt = JSON.stringify(g_stsData);
            var dt = new Date();
            dt.setDate(dt.getDate() + 7);
            document.cookie = txt;
            document.cookie = "expires=" + dt.toUTCString();
        }
        function lstRemove(a, id) {
            for (var i in a) {
                if (a[i] == id) {
                    a.splice(i, 1);
                    break;
                }
            }
        }
    </script>
    <script>
        //adj css style for modile
        function getStyleRule(unique_title) {
            for (var i = 0; i < document.styleSheets.length; i++) {
                var sheet = document.styleSheets[i];
                for (var j in sheet.cssRules) {
                    var rule = sheet.cssRules[j];
                    if (rule.selectorText == unique_title) {
                        return rule;
                    }
                }
            }
        }
        function adjCssStyle(isAndroid) {
            if (isAndroid) {
                var rule = getStyleRule("button.miStsBtn");
                rule.style['margin-top'] = '-5px';
                rule.style['font-family'] = 'Cambria Math';
                rule.style['transform'] = 'scale(1.5, 1.5)';

                var r2 = getStyleRule("button.miImgBtn");
                r2.style['margin-top'] = '6px';
                r2.style['font-family'] = 'Cambria, Cochin, Georgia, Times, Times New Roman, serif';
                r2.style['transform'] = 'scale(1, 1)';

                var r3 = getStyleRule("button.playBtn");
                r3.style['transform'] = 'scale(1.4, 1.4)';
                r3.style['margin-right'] = '10px';
                r3.style['margin-left'] = '10px';

                g_impSrc = {
                    "expand": "＋", //"▷＋",
                    "colapse": "－", //"▽－",
                    "noop": "　",
                    "checked": "◼",
                    "uncheck": "◻",
                    "gray": "▣",
                };
            }
        }
    </script>
    <script>
        function updateSutraTitle() {
            var d = document.getElementById("id_sutraTitle");
            //var path = g_lectLst[0].path;
            //n = path.indexOf('/');
            //d.innerText = path.substr(0,n);
            d.innerText = document.getElementById("root_0_span").innerText;
        }
    </script>
    <script>
        function renderAllTites() {
            renderTitles(g_lectLst, document.getElementById("id_content"));
        }
        function renderTitles(titles, parent, len) {
            var prevt2 = "";
            for (var ti in titles) {
                var t = titles[ti];
                var end = t.path.length - t.title.length;
                var t2 = t.path.slice(len + 1, end - 1);
                if (t2 != prevt2) {
                    var h2 = parent.appendChild(document.createElement('h2'));
                    h2.style.textAlign = 'center';
                    h2.innerText = t2.replace('/', '\r');
                    prevt2 = t2;
                }

                var d = parent.appendChild(document.createElement('div'));
                    d.style.pageBreakAfter = 'always';
                var pars = t.paragraphs;
                var h3 = d.appendChild(document.createElement('h3'));
                h3.innerText = pars[0].content;
                h3.style.textAlign = 'center';
                for (var i = 1; i < pars.length;i++) {
                    var par = pars[i];
                    var el = document.createElement('p');
                    if (par.alignment == 1) {
                        el.style.textAlign = 'center';
                    }
                    if (par.fontBold == -1) {
                        el.style.fontWeight = 'bold';
                    }
                    if (par.fontItalic == -1) {
                        el.style.fontStyle = 'italic';
                    }
                    el.style.paddingLeft = par.leftIndent;
                    el.innerText = par.content.replace(/\u000b/g, '\r');
                    d.appendChild(el);
                }
            }
        }
        function printAll() {
            var answer = window.prompt("print ration (for mobie: 3 / for desktop: 1)", "3");
            var ratio = parseFloat(answer);

            var a = window.open('', '', 'height=500, width=500');
            a.document.write('<style>@page {size: auto;  margin: 0mm; }</style>');
            a.document.close();
            var span0 = document.getElementById("root_0_span");
            var t1 = span0.innerText;
            a.document.title = t1;

            var d = a.document.body.appendChild(a.document.createElement('div'));
            var css = getComputedStyle(span0, null);
            var s = css.getPropertyValue('font-size');
            d.style.fontSize = parseFloat(s) * ratio;
            d.style.padding = 30;

            var h1 = d.appendChild(a.document.createElement('h1'));
            h1.style.textAlign = 'center';
            h1.innerText = t1;

            var arr = [];
            for (var k in g_nodesDict) {
                var node = g_nodesDict[k];
                arr.push(node.name);
                if (node.childs == null) { arr = arr.slice(0, 1); break;}
                if (Object.keys(node.childs).length > 1) { break; }
            }
            t1 = arr.join('\r');
            a.document.title = t1;
            h1.innerText = t1;
            
            renderTitles(g_lectLst, d, t1.length);
            //a.oncancel = function () { alert('cancel')};
            //a.onafterprint = function () { alert('after print') };
            a.print();
            a.close();	//ok on chrome
        } 
    </script>
    <script>
        //mainx1() - part x1
        document.getElementById("id_gotoTopBtn").style.display = "none";
        window.onscroll = onScroll;
        document.getElementById("id_content").onscroll = onscroll;

        //mainx2() - part x2
        var g_ratio = window.devicePixelRatio || 1;
        //document.getElementById("log").innerText = "ration:" + ratio;
        //adjMenuSize(g_ratio);
        window.onresize = ctrlsResize;

        var g_isAndroid = g_ratio > 1.5;
        adjCssStyle(g_isAndroid);

        render1(g_lectLst); //render tree

        //updateSutraTitle();

        adjFont(g_ratio);
        ctrlsResize();

        g_playingTitle = g_lectLst[0];
        g_playingPar = 0;
        renderTitle(g_lectLst[0].paragraphs,
            document.getElementById("id_content"));

        menuShowHide();

        ck_restore();   //restore cookie
    </script>
</body>
</html>
